if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }

__d("LSLocalApplyOptimisticGroupThread",["LSArrayGetObjectAt","LSCreateOfflineThreadingID","LSGetViewerFBID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[];return c.seq([function(f){return c.seq([function(a){return c.sp(b("LSCreateOfflineThreadingID"),c.i64.of_float(Date.now())).then(function(a){return a=a,d[0]=a[0],a})},function(a){return d[1]=[64,1083495711],d[2]=[0,0],c.sp(b("LSGetViewerFBID")).then(function(a){return a=a,d[3]=a[0],a})},function(a){return c.fe(c.ftr(c.db.table(9).fetch([[[d[0]]]]),function(a){return c.i64.eq(a.threadKey,d[0])&&c.i64.lt(a.authorityLevel,[0,20])}),function(a){return a["delete"]()})},function(b){return c.db.table(9).add({threadKey:d[0],mailboxType:[0,0],threadType:[0,2],clientThreadKey:d[0],folderName:"inbox",parentThreadKey:[0,0],lastActivityTimestampMs:[0,0],lastReadWatermarkTimestampMs:[0,0],snippetHasEmoji:!1,snippetSenderContactId:d[3],ongoingCallState:[0,0],authorityLevel:[0,20],capabilities:d[1],capabilities2:d[2],nullstateDescriptionText1:a[1],threadName:a[2]})},function(e){return d[4]=c.i64.of_int32(a[0].length),c.i64.gt(d[4],[0,0])?c.loopAsync(d[4],function(e){return d[5]=e,c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAt"),a[0],d[5]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(a){return c.fe(c.ftr(c.db.table(14).fetch([[[d[0],d[6]]]]),function(a){return c.i64.eq(a.threadKey,d[0])&&c.i64.eq([0,0],[0,0])&&c.i64.eq(a.contactId,d[6])&&c.i64.lt(a.authorityLevel,[0,20])}),function(a){return a["delete"]()})},function(a){return c.db.table(14).add({threadKey:d[0],contactId:d[6],readWatermarkTimestampMs:[0,0],deliveredWatermarkTimestampMs:[0,0],authorityLevel:[0,20],isModerator:!1})}])}):c.resolve()},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSLocalCreateOptimisticGroupThread",["LSIssueNewTask","LSLocalApplyOptimisticGroupThread"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return c.sp(b("LSLocalApplyOptimisticGroupThread"),a[0],a[1],f).then(function(a){return a=a,d[0]=a[0],a})},function(e){return d[1]=new c.Map(),d[1].set("participants",a[0]),d[1].set("client_thread_key",d[0]),d[1].set("sync_group",[0,1]),d[2]=d[1].get("client_thread_key"),d[1],d[3]=c.toJSON(d[1]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[2]),[0,153],d[3],f,f,[0,0],[0,0],f,f,[0,0])},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("MWSwitch.react",["cr:1925","cr:1926","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){var c=a.icon,d=a.size;a=babelHelpers.objectWithoutPropertiesLoose(a,["icon","size"]);if(b("cr:1925"))return h.jsx(b("cr:1925"),babelHelpers["extends"]({},a,{icon:c,size:d}));return b("cr:1926")?h.jsx(b("cr:1926"),babelHelpers["extends"]({},a)):null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWInboxInfoNotifications.bs",["fbt","CometLazyDialogTrigger.react","JSResource","MWChatUnmuteThread.bs","MWPUseIsThreadMuted.bs","MessengerMuteUtils.bs","bs_curry","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react");function a(a){var c=a.thread,d=a.children;a=b("MessengerMuteUtils.bs").calcMuteUntilMs(c);var e=b("MWPUseIsThreadMuted.bs").useHook(c),f=b("MWChatUnmuteThread.bs").useHook(void 0),h=e?g._(/*FBT_CALL*/"B\u1eadt l\u1ea1i th\u00f4ng b\u00e1o"/*FBT_CALL*/):g._(/*FBT_CALL*/"T\u1eaft th\u00f4ng b\u00e1o"/*FBT_CALL*/);a=b("MessengerMuteUtils.bs").mutedUntilLabel(a===-1?a:a/1e3);var j=a!==void 0&&e?a:void 0,k=i.useRef(null);return i.jsx(b("CometLazyDialogTrigger.react"),{dialogResource:b("JSResource")("LSMuteThreadDialogForJSResource.react").__setRef("MWInboxInfoNotifications.bs"),dialogProps:{onClose:function(a){},threadKey:c.threadKey},children:function(a){return b("bs_curry")._5(d,function(d){if(e)return b("bs_curry")._1(f,c);else return b("bs_curry")._1(a,void 0)},k,h,j,e)}})}c=a;f.make=c}),null);
__d("MWUIParticipantDetails.bs",["cr:607"],(function(a,b,c,d,e,f){"use strict";c=(a=b("cr:607")).useParticipantName;d=a.useParticipantShortName;e=a.useParticipantSecondaryName;b=a.useNameAndGender;var g=a.useParticipantReachabilityStatus,h=a.useParticipantProfilePictureUrl;f.$MWLSParticipantDetails$OR$WorkplaceMSParticipantDetails$requireCond=a;f.useParticipantName=c;f.useParticipantShortName=d;f.useParticipantSecondaryName=e;f.useNameAndGender=b;f.useParticipantReachabilityStatus=g;f.useParticipantProfilePictureUrl=h}),null);
__d("MWV2ThreadPreview.bs",["LS.bs","LSAuthorityLevel.bs","LSContactBlockedByViewerStatus.bs","LSContactGender.bs","LSContactIdType.bs","LSContactType.bs","LSContactViewerRelationship.bs","LSContactWorkForeignEntityType.bs","LSDatabaseType.bs","LSLocalCreateOptimisticGroupThread","LSMessagingThreadTypeUtil.bs","LSTransaction.bs","LSVec.bs","LSVerifyContactRowExists","LSVerifyThreadRowExists","MWLSActor.bs","MWPThreadTheme.bs","MWThreadKey.bs","MWV2OpenAndSecureThreadView.bs","MessagingThreadType.bs","Promise","ReQL.bs","ReQLSubscription.bs","ReQLSuspense","SortedAsyncIterable.bs","bs_belt_Option","bs_caml","bs_caml_array","bs_caml_option","bs_curry","bs_int64","cr:2891","promiseDone","react","recoverableViolation","stylex","useReStore"],(function(a,b,c,d,e,f){"use strict";var g,h,i=g||b("react"),j={container:{display:"j83agx80",flexDirection:"cbu4d94t",flexGrow:"buofh1pr",minHeight:"tgvbjcpo",fontSize:"jq4qci2q"},preview:{flexGrow:"buofh1pr",minHeight:"tgvbjcpo",display:"j83agx80",flexDirection:"cbu4d94t"},composer:{minHeight:"pxsmfnpt",flexShrink:"pfnyh3mw"}};function k(a){var c=b("useReStore")();i.useEffect(function(){b("LSTransaction.bs").run(c,function(c){return b("Promise").all(a.map(function(a){return b("LSVerifyContactRowExists")(a.id,b("LSContactIdType.bs").fbid,void 0,void 0,b("LSContactType.bs").user,void 0,void 0,void 0,void 0,!1,!1,b("LSContactBlockedByViewerStatus.bs").unblocked,void 0,!1,b("LSAuthorityLevel.bs").clientPartial,void 0,void 0,b("LSContactWorkForeignEntityType.bs").unknown,b("LSContactGender.bs").unknown,b("LSContactViewerRelationship.bs").unknown,void 0,b("LS.bs").make(c))}))},"readWrite")},[c,JSON.stringify(a.map(function(a){return b("bs_int64").to_string(a.id)}))])}function l(a){var c=a.thread;a=a.children;return i.jsx(b("MWThreadKey.bs").make,{id:c.threadKey,children:i.jsxs("div",{className:(h||(h=b("stylex")))(j.container),children:[i.jsx("div",{className:h(j.preview),children:i.jsx(b("MWPThreadTheme.bs").make,{themeFbid:c.themeFbid,children:i.jsx(b("MWV2OpenAndSecureThreadView.bs").make,{thread:c})})}),i.jsx("div",{className:h(j.composer),children:a})]})})}d={make:l};function m(a){var c=a.recipientToken,d=a.setPreviewThread;a=a.children;var e=b("useReStore")(),f=c.threadType,g=c.id;k([c]);i.useEffect(function(){b("promiseDone")(b("LSTransaction.bs").run(e,function(a){return b("LSVerifyThreadRowExists")(g,f,b("LSDatabaseType.bs").mailbox,b("LS.bs").make(a))},"readWrite"),void 0,void 0)},[e,b("bs_int64").to_string(g),JSON.stringify(f)]);var h=b("ReQLSubscription.bs").useFirst(i.useMemo(function(){return b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(e.table("threads")),{hd:g,tl:0})},[e,g]));i.useEffect(function(){b("bs_curry")._1(d,function(a){return h})},[h]);if(h!==void 0)return i.jsx(l,{thread:h,children:a});else return null}e={make:m};function a(a){var c=a.recipientToken,d=a.tokens,e=a.setPreviewThread;a=a.children;var f=b("useReStore")(),g=c.threadType,h=c.id;c=i.useState(function(){});var j=c[1],k=c[0];i.useEffect(function(){var a=0;b("cr:2891")==null||!b("LSMessagingThreadTypeUtil.bs").isSecure(g)?a=1:b("promiseDone")(b("LSTransaction.bs").run(f,function(a){return b("bs_curry")._3(b("cr:2891").call,a,d,b("MessagingThreadType.bs").secureMessageOverWaOneToOne)},"readWrite"),function(a){return b("bs_curry")._1(j,function(b){return a})},void 0);a===1&&(b("promiseDone")(b("LSTransaction.bs").run(f,function(a){return b("LSVerifyThreadRowExists")(h,g,b("LSDatabaseType.bs").mailbox,b("LS.bs").make(a))},"readWrite"),void 0,void 0),b("bs_curry")._1(j,function(a){return h}))},[f,b("bs_int64").to_string(h),g]);i.useEffect(function(){b("LSTransaction.bs").run(f,function(a){return b("LSVerifyContactRowExists")(h,b("LSContactIdType.bs").fbid,void 0,void 0,b("LSContactType.bs").user,void 0,void 0,void 0,void 0,!1,!1,b("LSContactBlockedByViewerStatus.bs").unblocked,void 0,!1,b("LSAuthorityLevel.bs").clientPartial,void 0,void 0,b("LSContactWorkForeignEntityType.bs").unknown,b("LSContactGender.bs").unknown,b("LSContactViewerRelationship.bs").unknown,void 0,b("LS.bs").make(a))},"readWrite")},[f,b("bs_int64").to_string(h)]);var m=b("ReQLSubscription.bs").useFirst(i.useMemo(function(){if(k!==void 0)return b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(f.table("threads")),{hd:k,tl:0});else return b("SortedAsyncIterable.bs").empty(void 0)},[f,b("bs_belt_Option").map(k,b("bs_int64").to_string)]));i.useEffect(function(){b("bs_curry")._1(e,function(a){return m})},[m]);if(m!==void 0)return i.jsx(l,{thread:m,children:a});else return null}a={make:a};function n(a,c,d,e){var f=b("useReStore")(),g=b("bs_int64").to_string(b("MWLSActor.bs").useActor(void 0)),h=b("ReQLSubscription.bs").useArray(i.useMemo(function(){return b("ReQL.bs").map(b("ReQL.bs").filter(b("ReQL.bs").fromTableAscending(f.table("participants")),function(a){return c.has(b("bs_int64").to_string(a.contactId))}),function(a){return b("bs_int64").to_string(a.threadKey)})},[f,c]));return b("ReQLSubscription.bs").useFirst(i.useMemo(function(){var a,d=new Set(h);return(a=b("ReQL.bs")).filter(a.filter(a.filter(a.filter(a.fromTableAscending(f.table("threads")),function(a){return b("bs_caml").i64_eq(a.threadType,e)}),function(a){return a.threadName===void 0}),function(a){a=a.clientThreadKey;if(a!==void 0)return d.has(b("bs_int64").to_string(a));else return!1}),function(a){a=a.clientThreadKey;if(a===void 0)return!1;a=b("ReQLSuspense").toArray(b("ReQL.bs").filter(b("ReQL.bs").map(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromIndexDescending(f.table("participants").index("threadKeyReadWatermarkTimestampMs")),{hd:a,tl:0}),function(a){return b("bs_int64").to_string(a.contactId)}),function(a){return a!==g}));if(a.every(function(a){return c.has(a)}))return a.length===c.size;else return!1})},[f,h,c,g,JSON.stringify(e)]))}function o(a,c,d){var e=b("useReStore")();i.useEffect(function(){a===void 0&&b("promiseDone")(b("LSTransaction.bs").run(e,function(a){if(b("bs_caml").i64_eq(c,b("MessagingThreadType.bs").group))return b("LSLocalCreateOptimisticGroupThread")(b("LSVec.bs").make(d.map(function(a){return a.id})),void 0,b("LS.bs").make(a)).then(function(a){});else if(b("LSMessagingThreadTypeUtil.bs").isSecure(c))if(b("cr:2891")==null)return b("Promise").resolve(void 0);else return b("bs_curry")._3(b("cr:2891").call,a,d,c).then(function(a){});else{b("recoverableViolation")("Don't know how to create optimistic thread for thread of thread type"+b("bs_belt_Option").getWithDefault(JSON.stringify(c),""),"messenger_web_product");return b("Promise").resolve(void 0)}},"readWrite"),void 0,void 0)},[e,d,JSON.stringify(a),JSON.stringify(c)])}function p(a){var c=a.tokens,d=a.tokensExcludingActor,e=a.tokenContactIdsExcludingActor,f=a.setPreviewThread,g=a.threadType;a=a.children;var h=n(d,e,f,g);k(d);o(h,g,c);i.useEffect(function(){b("bs_curry")._1(f,function(a){return h})});if(h!==void 0)return i.jsx(l,{thread:h,children:a});else return null}var q={useFindMatchingOptimisticThreadWithParticipants:n,useCreateOptimisticThreadForTokens:o,make:p};function r(a,c,d,e){var f=b("useReStore")(),g=b("bs_int64").to_string(b("MWLSActor.bs").useActor(void 0)),h=b("ReQLSubscription.bs").useArray(i.useMemo(function(){return b("ReQL.bs").map(b("ReQL.bs").filter(b("ReQL.bs").fromTableAscending(f.table("participants")),function(a){return c.has(b("bs_int64").to_string(a.contactId))}),function(a){return b("bs_int64").to_string(a.threadKey)})},[f,c]));return b("ReQLSubscription.bs").useFirst(i.useMemo(function(){var a,d=new Set(h);return(a=b("ReQL.bs")).filter(a.filter(a.filter(a.filter(a.fromTableAscending(f.table("threads")),function(a){return b("bs_caml").i64_eq(a.threadType,e)}),function(a){return a.threadName===void 0}),function(a){return d.has(b("bs_int64").to_string(a.threadKey))}),function(a){a=b("ReQLSuspense").toArray(b("ReQL.bs").map(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromIndexDescending(f.table("participants").index("threadKeyReadWatermarkTimestampMs")),{hd:a.threadKey,tl:0}),function(a){return b("bs_int64").to_string(a.contactId)}));var d=a.filter(function(a){return a!==g});if(a.length===d.length||d.length!==c.size)return!1;else return d.every(function(a){return c.has(a)})})},[f,h,c,g,JSON.stringify(e)]))}function s(a){var c=a.tokensExcludingActor,d=a.tokens,e=a.threadType,f=a.setPreviewThread;a=a.children;var g=i.useMemo(function(){return new Set(c.map(function(a){return b("bs_int64").to_string(a.id)}))},[c]),h=r(c,g,f,e);i.useEffect(function(){h!==void 0&&b("bs_curry")._1(f,function(a){return h})},[h]);if(h!==void 0)return i.jsx(l,{thread:h,children:a});else return i.jsx(p,{tokens:d,tokensExcludingActor:c,tokenContactIdsExcludingActor:g,setPreviewThread:f,threadType:e,children:a})}var t={useFindExistingThreadWithTokens:r,make:s};function c(a){var c=a.tokens,d=a.areWeCreatingASecureThread,e=a.setPreviewThread,f=a.nullstate;a=a.children;f=f!==void 0?b("bs_caml_option").valFromOption(f):null;var g=b("MWLSActor.bs").useActor(void 0),h=i.useMemo(function(){return c.filter(function(a){return b("bs_caml").i64_neq(a.id,g)})},[c,g]);i.useEffect(function(){c.length===0&&b("bs_curry")._1(e,function(a){})},[c]);if(c.length===0)return f;var j=h.length;if(j!==1)if(j!==0)return i.jsx(s,{tokensExcludingActor:h,tokens:c,threadType:d?b("MessagingThreadType.bs").secureMessageOverWaGroup:b("MessagingThreadType.bs").group,setPreviewThread:e,children:a});else if(d)return f;else return i.jsx(m,{recipientToken:b("bs_caml_array").get(c,0),setPreviewThread:e,children:a});j=h[0];if(d)return i.jsx(s,{tokensExcludingActor:h,tokens:c,threadType:b("MessagingThreadType.bs").secureMessageOverWaOneToOne,setPreviewThread:e,children:a});else return i.jsx(m,{recipientToken:j,setPreviewThread:e,children:a})}var u=b("cr:2891");c=c;f.$MAWCreateOptimisticSecureThread$requireCondXplat=b("cr:2891");f.mawCreateOptimisticSecureThread=u;f.styles=j;f.ExistingThreadPreview=d;f.CanonicalThreadPreview=e;f.OneOnOnePreview=a;f.OptimisticThread=q;f.PossiblyOptimisticThread=t;f.make=c}),null);